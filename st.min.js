"use strict";module.exports=DependentResolve;function DependentResolve(e,t,r){var n=t.resolve[e];var s=n.length-1;this.key=e;this.name=e+"@"+t.name;this.state=t;this.cache=r;this.invokable=n[s];this.injectables=n.slice(0,s).map(function(e){return e.indexOf("@")>-1?e:e+"@"+t.name})}DependentResolve.prototype.execute=function(e,t){var r=this.injectables.map(function(e){return t[e]}).concat(e);return this.invokable.apply(this.state,r)};DependentResolve.prototype.getResult=function(){return this.cache.get(this.name)};DependentResolve.prototype.clearResult=function(){this.cache.unset(this.name);return this};"use strict";module.exports=ResolveGraph;function ResolveGraph(e,t){this.tasks=e;this.cache=t;this.graph=e.reduce(function(e,t){e[t.name]=t.waitingFor;return e},{})}ResolveGraph.prototype.ensureDependencies=function(){var e=this;e.tasks.filter(function(e){return!e.isReady()}).forEach(function(t){t.waitingFor.filter(function(t){return!(t in e.graph)}).forEach(function(r){t.setDependency(r,e.cache.get(r))})});return this};ResolveGraph.prototype.throwIfCyclic=function(){var e=this.graph;var t=1;var r=2;var n={};var s=[];var i;for(i in e){o(i)}return this;function o(i){if(n[i]===r)return;s.push(i);if(n[i]===t){s.splice(0,s.indexOf(i));throw new Error("Cyclic resolve dependency: "+s.join(" -> "))}n[i]=t;e[i].forEach(o);s.pop();n[i]=r}};ResolveGraph.prototype.getTasks=function(){return this.tasks};"use strict";module.exports=ResolveJob;function ResolveJob(e,t){this.tasks=e;this.remaining=e.length;this.transition=t;this.completed=[];this.results={};this.cancelled=false}ResolveJob.prototype.start=function(e){var t=this;t.callback=e;return t.tasks.filter(function(e){return e.isReady()}).forEach(function(e){return t.run(e)})};ResolveJob.prototype.run=function(e){var t=this;return t.dequeueTask(e).execute().then(function(r){if(t.cancelled)return;if(t.transition.isSuperceded()){return t.abort()}e.result=t.results[e.name]=r;t.completed.push(e);return--t.remaining?t.runDependentsOf(e):t.finish()}).catch(function(e){if(!t.cancelled){return t.abort(e)}})};ResolveJob.prototype.dequeueTask=function(e){return this.tasks.splice(this.tasks.indexOf(e),1)};ResolveJob.prototype.abort=function(e){this.cancelled=true;if(e)this.callback.call(null,e)};ResolveJob.prototype.runDependentsOf=function(e){var t=this;return t.tasks.filter(function(t){return t.isWaitingFor(e.name)}).forEach(function(r){return r.setDependency(e.name,e.result).isReady()?t.run(r):undefined})};ResolveJob.prototype.finish=function(){return this.callback.call(null,null,this.completed,this.results)};"use strict";module.exports=ResolveTask;function ResolveTask(e,t,r){this.resolve=e;this.name=e.name;this.params=t;this.cache=r;this.waitingFor=e.injectables?e.injectables.slice():[]}ResolveTask.prototype.isWaitingFor=function(e){return this.waitingFor.length&&this.waitingFor.indexOf(e)>-1};ResolveTask.prototype.setDependency=function(e,t){this.dependencies||(this.dependencies={});this.dependencies[e]=t;this.waitingFor.splice(this.waitingFor.indexOf(e),1);return this};ResolveTask.prototype.isReady=function(){return!this.waitingFor.length};ResolveTask.prototype.execute=function(){var e=this;return new ResolveTask.Promise(function(t,r){var n;try{n=e.resolve.execute(e.params,e.dependencies)}catch(s){return r(s)}return t(n)})};ResolveTask.prototype.commit=function(){this.cache.set(this.name,this.result);return this};"use strict";module.exports=SimpleResolve;function SimpleResolve(e,t,r){this.key=e;this.name=e+"@"+t.name;this.state=t;this.cache=r;this.invokable=t.resolve[e]}SimpleResolve.prototype.execute=function(e){return this.invokable.call(this.state,e)};SimpleResolve.prototype.getResult=function(){return this.cache.get(this.name)};SimpleResolve.prototype.clearResult=function(){this.cache.unset(this.name);return this};"use strict";var xtend=require("xtend/mutable");module.exports=State;function State(e){this.$includes={};this.$ancestors={};this.$paramKeys=[];this.$resolves=[];this.$viewports=[];this.$branch=[this];this.data={};xtend(this,e);this.$includes[this.name]=true;this.$ancestors[this.name]=this;if(this.parent&&typeof this.parent==="string")return this;var t=this.name.split(".");this.parent=t[1]?t.slice(1).join("."):null}State.prototype.$parent=null;State.prototype.inheritFrom=function(e){this.data=xtend({},e.data,this.data);xtend(this.$includes,e.$includes);xtend(this.$ancestors,e.$ancestors);this.$branch=e.$branch.concat(this.$branch);this.$parent=e;return this};State.prototype.contains=function(e){return this.$includes[e.name]||false};State.prototype.getBranch=function(){return this.$branch.slice()};State.prototype.shouldReload=function(e){if(this.$paramsKeys.length===0)return false;if(!this.$params)return true;var t=this;return t.$paramsKeys.some(function(r){return t.$params[r]!=e[r]})};State.prototype.addResolve=function(e){this.$resolves.push(e);return this};State.prototype.filterParams=function(e){return this.$paramKeys.reduce(function(t,r){t[r]=e[r];return t},{})};State.prototype.shutDown=function(){this.$views.forEach(function(e){e.destroy()});this.$params=null;return this};State.prototype.getViews=function(){return this.$views.slice()};State.prototype.getAllViews=function(){return this.getBranch().reverse().reduce(function(e,t){return e.concat(t.getViews())},[])};State.prototype.getAncestor=function(e){return this.$ancestors[e]||null};State.prototype.getResolveResults=function(){return this.$resolves.reduce(function(e,t){e[t.key]=t.getResult();return e},{})};State.prototype.definesViews=function(){return!!this.views||!!this.template};State.prototype.addViewport=function(e){this.$viewports.push(e)};"use strict";module.exports=View;function View(e,t,r){this.viewKey=e;this.data=t.data;this.renderer=r;var n=e.split("@");this.targetViewportName=n[0]||null;var s=n[1]?n[1]:t.name;this.targetState=s===t.name?t:t.getAncestor(s)}View.prototype.rendersDuring=function(e){return this.targetState===e};View.prototype.nestsIn=function(e){return this.targetViewportName===e};View.prototype.isActive=function(){return!!this.component};View.prototype.render=function(e){this.component=this.renderer.execute(this,e);return this};View.prototype.destroy=function(){var e=this.component;this.component=undefined;this.renderer.destroy(e);return this};"use strict";module.exports=Viewport;function Viewport(e){this.name=e;this.selector=e.indexOf("@")>-1?"sm-viewport:not([name])":'sm-viewport[name="'+e+'"]'}Viewport.prototype.element=null;Viewport.prototype.currentView=null;Viewport.prototype.previousView=null;Viewport.prototype.attachTo=function(e){this.element=e.querySelector(this.selector);return this};Viewport.prototype.detach=function(){this.element=null;return this};Viewport.prototype.getChildren=function(){return this.currentView.getViewports()};Viewport.prototype.setView=function(e){if(this.currentView)return this.replaceView(e);this.currentView=e;return this};Viewport.prototype.replaceView=function(e){this.previousView=this.currentView;this.currentView=e;return this};Viewport.prototype.cleanUp=function(){var e=this.previousView;if(!e)return;e.destroy();this.previousView=null;return this};Viewport.prototype.update=function(e){this.currentView.update(e);return this};Viewport.prototype.publish=function(e){this.element.innerHTML=this.currentView.render(e);return this};Viewport.prototype.isDirty=function(){return!!this.previousView};"use strict";module.exports={store:{},set:function(e,t){this.store[e]=t;return this},unset:function(e){delete this.store[e];return this},get:function(e){return this.store[e]},has:function(e){return e in this.store}};"use strict";var resolveCache=require("./resolveCache");var SimpleResolve=require("./SimpleResolve");var DependentResolve=require("./DependentResolve");var ResolveTask=require("./ResolveTask");var ResolveGraph=require("./ResolveGraph");var ResolveJob=require("./ResolveJob");module.exports={instantiate:function(e,t){return Array.isArray(t[e])?new DependentResolve(e,t,resolveCache):new SimpleResolve(e,t,resolveCache)},createTask:function(e,t){return new ResolveTask(e,t,resolveCache)},createJob:function(e,t){var r=new ResolveGraph(e,resolveCache);var n=r.ensureDependencies().throwIfCyclic().getTasks();return new ResolveJob(n,t)}};"use strict";var StateNode=require("./StateNode");var resolveFactory=require("./resolveFactory");module.exports={build:function(e,t){if(arguments.length===2)t.name=e;else t.name=e;if(!t.name||typeof t.name!=="string"){throw new Error("State definitions must include a string name")}var r=new StateNode(t);return this.addResolves(r)},addResolves:function(e){var t=e.resolve;var r,n;for(r in t){n=resolveFactory.instantiate(r,e);e.addResolve(n)}return e}};"use strict";module.exports={init:function(e){this.states={"":e};this.$root=e;this.stateQueues={}},add:function(e){var t=e.parent;var r=this.states[t];if(t&&!r){return this.enqueue(t,e)}this.states[e.name]=e.inheritFrom(r||this.$root);this.flushQueueOf(e.name);return this},enqueue:function(e,t){this.stateQueues[e]||(this.stateQueues[e]=[]);this.stateQueues[e].push(t);return this},flushQueueOf:function(e){var t=this.stateQueues[e];while(t&&t.length){this.add(t.pop())}}};"use strict";var Viewport=require("./Viewport");module.exports={states:{},queues:{},viewports:{},addState:function(e){this.states[e.name]||(this.states[e.name]=e);if(!e.definesViews())return this;return this.inferViewportsFrom(e).flushQueueOf(e)},inferViewportsFrom:function(e){if(!e.views){return this.createOne(null,e.name)}return this.createMany(e)},createOne:function(e,t){this.viewports[t]||(this.viewports[t]={});e||(e="@"+t);if(this.has(t,e))return this;var r=new Viewport(e);var n=this.states[t];this.viewports[t][e]=r;if(!n){return this.enqueue(r,t)}n.addViewport(r);return this},createMany:function(e){var t,r,n,s;for(t in e.views){r=t.split("@");n=r[0]||null;s=r[1]||e.name;this.createOne(n,s)}return this},enqueue:function(e,t){this.queues[t]||(this.queues[t]=[]);this.queues[t].push(e);return this},flushQueueOf:function(e){var t=this.queues[e.name];while(t&&t.length){e.addViewport(t.pop())}return this},has:function(e,t){return!!this.viewports[e][t]}};
